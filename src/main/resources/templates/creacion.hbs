<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{{titulo}}</title>
  <link rel="stylesheet" href="/assets/creacion.css">
</head>
<body>

  <div class="form-container">
    <h1>{{titulo}}</h1>

    {{#if flash_error}}
      <div class="flash error">{{flash_error}}</div>
    {{/if}}

    {{#if flash_message}}
      <div class="flash success">{{flash_message}}</div>
    {{/if}}

    <form action="/hechos" method="POST" enctype="multipart/form-data">
      {{!-- Fuente autom√°tica seg√∫n contexto --}}
      {{#if fuente}}
        <input type="hidden" name="fuenteId" value="{{fuente.id}}">
      {{/if}}

      <label for="titulo">T√≠tulo</label>
      <input type="text" name="titulo" placeholder="Ej: Incendio en el centro" required>

      <label for="descripcion">Descripci√≥n</label>
      <textarea name="descripcion" placeholder="Describe brevemente el hecho..." required></textarea>

      <label for="categoria">Categor√≠a</label>
      <input type="text" name="categoria" placeholder="Ej: Incendios, Accidentes, Contaminaci√≥n" required>

      <label for="latitud">Latitud</label>
      <input type="number" step="0.0001" name="latitud" placeholder="-34.6037" required>

      <label for="longitud">Longitud</label>
      <input type="number" step="0.0001" name="longitud" placeholder="-58.3816" required>

      <label for="fechaAcontecimiento">Fecha del Acontecimiento</label>
      <input type="datetime-local" name="fechaAcontecimiento" required>

        {{#if esRegistrado}}
      <label for="multimedia">Contenido Multimedia (imagen o video)</label>
      <input type="file" name="multimedia" accept="image/*,video/*">

      <div class="preview" id="preview-container">
        <p><strong>Vista previa:</strong></p>
        <div id="preview-content"></div>
      </div>
        {{/if}}
      <button type="submit">üìç Cargar Hecho</button>
    </form>

    <p class="mt-20">
      <a href="/home">‚¨ÖÔ∏è Volver al Inicio</a>
    </p>
  </div>

  <script>
    const input = document.querySelector('input[name="multimedia"]');
    const previewContainer = document.getElementById('preview-container');
    const previewContent = document.getElementById('preview-content');

    input.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) {
        previewContainer.style.display = 'none';
        return;
      }

      const url = URL.createObjectURL(file);
      previewContent.innerHTML = '';

      if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = url;
        previewContent.appendChild(img);
      } else if (file.type.startsWith('video/')) {
        const video = document.createElement('video');
        video.src = url;
        video.controls = true;
        previewContent.appendChild(video);
      }

      previewContainer.style.display = 'block';
    });
  </script>
</body>
</html>

